<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorry - Game Time</title>
    <link rel="stylesheet" href="apology-style.css">
    <style>
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .game-title {
            font-size: 2.5em;
            color: var(--dark-pink);
            margin-bottom: 1rem;
        }

        .tic-tac-toe {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            justify-content: center;
            margin: 2rem auto;
            background: var(--dark-pink);
            padding: 5px;
            border-radius: 15px;
        }

        .cell {
            width: 100px;
            height: 100px;
            background: var(--white);
            border: none;
            font-size: 2.5em;
            font-weight: bold;
            color: var(--dark-pink);
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .cell:hover {
            background: var(--light-pink);
            transform: scale(1.05);
        }

        .cell:disabled {
            cursor: not-allowed;
            transform: none;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            font-size: 1.2em;
        }

        .current-player {
            font-weight: bold;
            color: var(--purple);
        }

        .score {
            background: rgba(156, 39, 176, 0.1);
            padding: 10px 20px;
            border-radius: 20px;
            margin: 0 10px;
        }

        .winner-message {
            font-size: 1.5em;
            color: var(--dark-pink);
            font-weight: bold;
            margin: 1rem 0;
            min-height: 30px;
        }

        .panda-spot-1 { top: 15%; left: 3%; }
        .panda-spot-2 { top: 30%; right: 3%; animation-delay: 2s; }
        .panda-spot-3 { top: 60%; left: 5%; animation-delay: 4s; }
        .panda-spot-4 { top: 75%; right: 8%; animation-delay: 1s; }
    </style>
</head>
<body>
    <!-- Christmas Lights -->
    <div class="christmas-lights">
        <div class="light-string"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
        <div class="light-bulb"></div>
    </div>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-menu">
            <a href="index.html" class="nav-btn">ğŸ  Home</a>
            <a href="apology.html" class="nav-btn">ğŸ™ Apology</a>
            <a href="game.html" class="nav-btn">ğŸ® Game</a>
            <a href="message.html" class="nav-btn">ğŸ’Œ Message</a>
            <a href="flashcards.html" class="nav-btn">ğŸ“š Flashcards</a>
            <a href="song.html" class="nav-btn">ğŸµ Song</a>
            <a href="thank-you.html" class="nav-btn">â¤ï¸ Thank You</a>
        </div>
    </nav>

    <!-- Animated Pandas -->
    <div class="panda panda-spot-1">ğŸ¼</div>
    <div class="panda panda-spot-2">ğŸ¼</div>
    <div class="panda panda-spot-3">ğŸ¼</div>
    <div class="panda panda-spot-4">ğŸ¼</div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="card fade-in">
            <div class="game-container">
                <h1 class="game-title">Let's Play Tic-Tac-Toe! ğŸ®</h1>
                <p>Take a break and play a game together. Sometimes the best apologies come after a fun moment!</p>
                
                <div class="player-info">
                    <div class="score">
                        ğŸ¼ You: <span id="playerScore">0</span>
                    </div>
                    <div class="current-player">
                        Current Player: <span id="currentPlayer">ğŸ¼</span>
                    </div>
                    <div class="score">
                        ğŸ¤– Computer: <span id="computerScore">0</span>
                    </div>
                </div>

                <div class="winner-message" id="winnerMessage"></div>

                <div class="tic-tac-toe" id="gameBoard">
                    <button class="cell" data-index="0"></button>
                    <button class="cell" data-index="1"></button>
                    <button class="cell" data-index="2"></button>
                    <button class="cell" data-index="3"></button>
                    <button class="cell" data-index="4"></button>
                    <button class="cell" data-index="5"></button>
                    <button class="cell" data-index="6"></button>
                    <button class="cell" data-index="7"></button>
                    <button class="cell" data-index="8"></button>
                </div>

                <button class="btn-primary" onclick="resetGame()">New Game</button>
                <button class="btn-primary" onclick="resetScores()">Reset Scores</button>

                <div style="margin-top: 2rem;">
                    <p><em>Winning isn't what matters most - having fun together does! ğŸ˜Š</em></p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Game Rules ğŸ“‹</h2>
            <p>Get three in a row to win! You are ğŸ¼ and the computer is ğŸ¤–.</p>
            <p>Click on any empty square to make your move. Let's see if you can beat the computer!</p>
        </div>
    </main>

    <script>
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'ğŸ¼';
        let gameActive = true;
        let playerScore = 0;
        let computerScore = 0;

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
            [0, 4, 8], [2, 4, 6] // Diagonals
        ];

        function handleCellClick(event) {
            const cell = event.target;
            const index = cell.dataset.index;

            if (gameBoard[index] !== '' || !gameActive || currentPlayer !== 'ğŸ¼') {
                return;
            }

            makeMove(index, 'ğŸ¼');

            if (checkWin('ğŸ¼')) {
                endGame('ğŸ¼');
                return;
            }

            if (checkTie()) {
                endGame('tie');
                return;
            }

            currentPlayer = 'ğŸ¤–';
            updateCurrentPlayer();
            
            // Computer move with slight delay
            setTimeout(computerMove, 500);
        }

        function makeMove(index, player) {
            gameBoard[index] = player;
            const cell = document.querySelector(`[data-index="${index}"]`);
            cell.textContent = player;
            cell.disabled = true;
        }

        function computerMove() {
            if (!gameActive) return;

            const availableMoves = gameBoard.map((cell, index) => cell === '' ? index : null).filter(val => val !== null);
            
            if (availableMoves.length === 0) return;

            // Simple AI - try to win, block player, or pick random
            let move;
            
            // Try to win
            for (let condition of winningConditions) {
                const [a, b, c] = condition;
                if (gameBoard[a] === 'ğŸ¤–' && gameBoard[b] === 'ğŸ¤–' && gameBoard[c] === '') {
                    move = c;
                    break;
                }
                if (gameBoard[a] === 'ğŸ¤–' && gameBoard[c] === 'ğŸ¤–' && gameBoard[b] === '') {
                    move = b;
                    break;
                }
                if (gameBoard[b] === 'ğŸ¤–' && gameBoard[c] === 'ğŸ¤–' && gameBoard[a] === '') {
                    move = a;
                    break;
                }
            }

            // Try to block player
            if (move === undefined) {
                for (let condition of winningConditions) {
                    const [a, b, c] = condition;
                    if (gameBoard[a] === 'ğŸ¼' && gameBoard[b] === 'ğŸ¼' && gameBoard[c] === '') {
                        move = c;
                        break;
                    }
                    if (gameBoard[a] === 'ğŸ¼' && gameBoard[c] === 'ğŸ¼' && gameBoard[b] === '') {
                        move = b;
                        break;
                    }
                    if (gameBoard[b] === 'ğŸ¼' && gameBoard[c] === 'ğŸ¼' && gameBoard[a] === '') {
                        move = a;
                        break;
                    }
                }
            }

            // Pick center or random
            if (move === undefined) {
                if (gameBoard[4] === '') {
                    move = 4;
                } else {
                    move = availableMoves[Math.floor(Math.random() * availableMoves.length)];
                }
            }

            makeMove(move, 'ğŸ¤–');

            if (checkWin('ğŸ¤–')) {
                endGame('ğŸ¤–');
                return;
            }

            if (checkTie()) {
                endGame('tie');
                return;
            }

            currentPlayer = 'ğŸ¼';
            updateCurrentPlayer();
        }

        function checkWin(player) {
            return winningConditions.some(condition => {
                return condition.every(index => gameBoard[index] === player);
            });
        }

        function checkTie() {
            return gameBoard.every(cell => cell !== '');
        }

        function endGame(winner) {
            gameActive = false;
            const winnerMessage = document.getElementById('winnerMessage');
            
            if (winner === 'ğŸ¼') {
                winnerMessage.textContent = 'ğŸ‰ You won! Great job! ğŸ‰';
                playerScore++;
                document.getElementById('playerScore').textContent = playerScore;
                celebrateWin();
            } else if (winner === 'ğŸ¤–') {
                winnerMessage.textContent = 'ğŸ˜… Computer wins! Try again! ğŸ˜…';
                computerScore++;
                document.getElementById('computerScore').textContent = computerScore;
            } else {
                winnerMessage.textContent = 'ğŸ¤ It\'s a tie! Good game! ğŸ¤';
            }
        }

        function resetGame() {
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = 'ğŸ¼';
            gameActive = true;
            
            document.getElementById('winnerMessage').textContent = '';
            document.querySelectorAll('.cell').forEach(cell => {
                cell.textContent = '';
                cell.disabled = false;
            });
            
            updateCurrentPlayer();
        }

        function resetScores() {
            playerScore = 0;
            computerScore = 0;
            document.getElementById('playerScore').textContent = playerScore;
            document.getElementById('computerScore').textContent = computerScore;
            resetGame();
        }

        function updateCurrentPlayer() {
            document.getElementById('currentPlayer').textContent = currentPlayer;
        }

        function celebrateWin() {
            const emojis = ['ğŸ‰', 'ğŸŠ', 'ğŸŒŸ', 'âœ¨', 'ğŸˆ', 'ğŸ'];
            for(let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.position = 'fixed';
                    emoji.style.fontSize = '3em';
                    emoji.style.left = Math.random() * (window.innerWidth - 100) + 'px';
                    emoji.style.top = '-50px';
                    emoji.style.pointerEvents = 'none';
                    emoji.style.zIndex = '1000';
                    emoji.style.animation = 'celebration 3s ease-out forwards';
                    document.body.appendChild(emoji);
                    
                    setTimeout(() => emoji.remove(), 3000);
                }, i * 200);
            }
        }

        function smoothNavigate(page) {
            document.body.classList.add('page-exit');
            setTimeout(() => {
                window.location.href = page;
            }, 500);
        }

        // Add celebration animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes celebration {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(${window.innerHeight + 100}px) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.addEventListener('click', handleCellClick);
            });
        });
    </script>
</body>
</html>